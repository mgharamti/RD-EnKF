clear 
clc

BLUE   = [236,231,242; 166,189,219;  43,140,190]/255;

lB = [ 153, 255, 255 ]/255;
lP = [ 204, 153, 255 ]/255;
bL = [  30, 144, 255 ]/255;
rD = [ 255,  51,  51 ]/255;
gR = [   0, 153,   0 ]/255;
pR = [ 153,  51, 255 ]/255;
oR = [ 255, 153,  51 ]/255;
bK = [   0,   0,   0 ]/255;
gY = [ 150, 150, 150 ]/255;

obs  = [2231342, 2231600, 2232155, 2232000, 2232200, 2232400, 2232500, 2233475, ...
        2233484, 2233500, 2234000, 2234324, 2234344, 2234384, 2234400, 2234990, ...
        2235000, 2235200, 2235500, 2236500, 2236605, 2237293, 2238500, 2239000, ...
        2239501, ...
        ...
        2240000, 2240500, 2243000, 2243960, 2244333, 2245500, 2247510, 2248000, ...
        2249007, 2249500, ...
        ...
        2251000, 2251500, 2256500, ...
        ...
        2262900, 2263800, 2263869, 2264003, 2264030, 2264051, 2264100, 2264495, ...
        2266200, 2266291, 2266300, 2266480, 2266496, ...
        ...
        2270000, 2270500, 2271500, 2272650, 2272676, 2274005, 2274010, 2274490, ...
        2275197, ...
        ...
        2291580, 2292010, 2293987, 2294161, 2294217, 2294330, 2294405, 2294650, ...
        2294898, 2295194, 2295420, 2295520, 2295580, 2295637, 2296260, 2296500, ...
        2296750, 2297100, 2297155, 2297310, 2297600, 2298110, 2298123, 2298202, ...
        2298488, 2298492, 2298495, 2298527, 2298530, 2298554, 2298608, 2298760, ...
        2298830, 2298880, 2299410, 2299450, 2299472, 2299950, ...
        ...
        2300017, 2300018, 2300033, 2300042, 2300075, 2300100, 2300210, 2300300, ...
        2300500, 2300700, 2300882, 2301000, 2301150, 2301300, 2301500, 2301738, ...
        2301740, 2301745, 2301750, 2301793, 2301900, 2301990, 2302500, 2303000, ...
        2303330, 2303350, 2304500, 2306500, 2306647, 2306774, 2306950, 2307000, ...
        2307323, 2307359, 2307445, 2307668, 2307674, 2307780, 2309415, 2309421, ...
        2309425, 2309740, ...
        ...
        2310000, 2310525, 2310675, 2310947, 2311000, 2311500, 2312000, 2312180, ...
        2312200, 2312300, 2312500, 2312558, 2312598, 2312600, 2312640, 2312645, ...
        2312667, 2312675, 2312700, 2312720, 2312762, 2312764, 2313000, 2313098, ...
        2313100, ...
        ...
        2320700, 2321000, 2321500, 2321898, 2321958, 2322700, 2322800, ...
        ...
        ];

dir_ol   = {'Exp/N80_ol'};
dir_exps = {'Exp/N20_infprpo', ...
            'Exp_rd/rd_N20_infprpo_a0.1', 'Exp_rd/rd_N20_infprpo_a0.2', ...
            'Exp_rd/rd_N20_infprpo_a0.3', 'Exp_rd/rd_N20_infprpo_a0.4', ...
            'Exp_rd/rd_N20_infprpo_a0.5'};

[current, xticks, xtickslabel, gt, obs_all, openloop_all, forecast_all, analysis_all] = ...
    HydroDARTdiags(dir_exps, obs, dir_ol, 0, 0, 0);

Nt = length(current);

%% Hydrographs
figure('pos', [285, 420, 1500, 650]) 

OG   = {'02297310', '02300017', '02300100'};
OI   = [     80,      99,     104];

str1 = {['USGS Gauge ID: 0'  num2str(obs_all{2, OI(1), 1})], 'Horse Creek at SR 72 near Arcadia, FL'};
str2 = {['USGS Gauge ID: 0'  num2str(obs_all{2, OI(2), 1})], 'Gamble Creek at Co Rd. 675 near Parrish, FL'};
str3 = {['USGS Gauge ID: 0'  num2str(obs_all{2, OI(3), 1})], 'Little Manatee River near Ft. Lonesome, FL'};

tiledlayout(2,3)

%%%%%% 1
nexttile; e = 1; o = OI(1); pp = 300; dd = 35; Z = ceil(linspace(1, Nt, dd));

en_f = plot(current, forecast_all{8, o, e}   , '-', 'Color', gY); hold on
en_a = plot(current, analysis_all{7, o, e}   , '-', 'Color', BLUE(2,:)); grid on 

ob_a = plot(current, obs_all{7, o, e}, '*', 'Color', gR, 'MarkerSize', 8); 
ob_r = plot(current, obs_all{8, o, e}, '*', 'Color', rD, 'MarkerSize', 8);

op   = plot(current, openloop_all{1, o}      , '-', 'Color', oR, 'LineWidth', 4); 
mf   = plot(current, forecast_all{6, o, e}   , '-', 'Color', bK, 'LineWidth', 4); 
ma   = plot(current, analysis_all{6, o, e}   , '-', 'Color', bL, 'LineWidth', 4); 

zL = [current(pp+1), current(end-pp)];

set(gca, 'FontSize', 16, 'XLim', zL, ...
         'XTick', current(Z), 'XTickLabel', gt(Z,:), 'Ylim', [0 1800], ...
         'YTickLabelRotation', 90)

L = legend([ob_a, ob_r, op, en_f(1), mf, en_a(1), ma], 'Used Obs (cms)'          , ...
                sprintf('Rejected Obs: %.0f%%'       , 100-obs_all{4, o, e}/obs_all{3, o, e}*100), ...
                sprintf('OL RMSE: %.2f'              , nanmean(openloop_all{2, o})), ...
                'Prior Ensemble', ...
                sprintf('Prior RMSE: %.2f'           , nanmean(forecast_all{2, o, e})), ...
                'Post Ensemble', ...
                sprintf('Post RMSE: %.2f'            , nanmean(analysis_all{2, o, e})), ...
                'Location', 'NorthEast');
        
set(L, 'Interpreter', 'none', 'FontSize', 14) 

ylabel('20-mem EnKF', 'FontSize', 20, 'FontWeight', 'bold')

title(str1, 'FontSize', 20, 'FontWeight', 'bold', 'Interpreter', 'none')

%%%%%% 2
nexttile; o = OI(2); pp1 = 200; pp2 = 100; dd = 10; Z = ceil(linspace(1, Nt, dd));

en_f = plot(current, forecast_all{8, o, e}   , '-', 'Color', gY); hold on
en_a = plot(current, analysis_all{7, o, e}   , '-', 'Color', BLUE(2,:)); grid on 

ob_a = plot(current, obs_all{7, o, e}, '*', 'Color', gR, 'MarkerSize', 8); 
ob_r = plot(current, obs_all{8, o, e}, '*', 'Color', rD, 'MarkerSize', 8);

op   = plot(current, openloop_all{1, o}      , '-', 'Color', oR, 'LineWidth', 4); 
mf   = plot(current, forecast_all{6, o, e}   , '-', 'Color', bK, 'LineWidth', 4); 
ma   = plot(current, analysis_all{6, o, e}   , '-', 'Color', bL, 'LineWidth', 4); 

zL = [current(pp1+1), current(end-pp2)];

set(gca, 'FontSize', 16, 'XLim', zL, ...
         'XTick', current(Z), 'XTickLabel', gt(Z,:), 'Ylim', [0 50], 'YTick', 5:10:45, ...
         'YTickLabelRotation', 90)

L = legend([ob_a, ob_r, op, en_f(1), mf, en_a(1), ma], 'Used Obs (cms)'          , ...
                sprintf('Rejected Obs: %.0f%%'       , 100-obs_all{4, o, e}/obs_all{3, o, e}*100), ...
                sprintf('OL RMSE: %.2f'              , nanmean(openloop_all{2, o})), ...
                'Prior Ensemble', ...
                sprintf('Prior RMSE: %.2f'           , nanmean(forecast_all{2, o, e})), ...
                'Post Ensemble', ...
                sprintf('Post RMSE: %.2f'            , nanmean(analysis_all{2, o, e})), ...
                'Location', 'NorthEast');
        
set(L, 'Interpreter', 'none', 'FontSize', 14) 

title(str2, 'FontSize', 20, 'FontWeight', 'bold', 'Interpreter', 'none')


%%%%%% 3
nexttile; o = OI(3); pp = 252; dd = 16; Z = ceil(linspace(1, Nt, dd));

en_f = plot(current, forecast_all{8, o, e}   , '-', 'Color', gY); hold on
en_a = plot(current, analysis_all{7, o, e}   , '-', 'Color', BLUE(2,:)); grid on 

ob_a = plot(current, obs_all{7, o, e}, '*', 'Color', gR, 'MarkerSize', 8); 
ob_r = plot(current, obs_all{8, o, e}, '*', 'Color', rD, 'MarkerSize', 8);

op   = plot(current, openloop_all{1, o}      , '-', 'Color', oR, 'LineWidth', 4); 
mf   = plot(current, forecast_all{6, o, e}   , '-', 'Color', bK, 'LineWidth', 4); 
ma   = plot(current, analysis_all{6, o, e}   , '-', 'Color', bL, 'LineWidth', 4); 

zL = [current(pp+1), current(end-pp)];

set(gca, 'FontSize', 16, 'XLim', zL, ...
         'XTick', current(Z), 'XTickLabel', gt(Z,:), 'Ylim', [0 200], 'ytick', 25:50:175, ...
         'YTickLabelRotation', 90)

L = legend([ob_a, ob_r, op, en_f(1), mf, en_a(1), ma], 'Used Obs (cms)'          , ...
                sprintf('Rejected Obs: %.0f%%'       , 100-obs_all{4, o, e}/obs_all{3, o, e}*100), ...
                sprintf('OL RMSE: %.2f'              , nanmean(openloop_all{2, o})), ...
                'Prior Ensemble', ...
                sprintf('Prior RMSE: %.2f'           , nanmean(forecast_all{2, o, e})), ...
                'Post Ensemble', ...
                sprintf('Post RMSE: %.2f'            , nanmean(analysis_all{2, o, e})), ...
                'Location', 'NorthEast');
        
set(L, 'Interpreter', 'none', 'FontSize', 14) 

title(str3, 'FontSize', 20, 'FontWeight', 'bold', 'Interpreter', 'none')


%%%%%% 4
nexttile; e = 3; o = OI(1); pp = 300; dd = 35; Z = ceil(linspace(1, Nt, dd));

en_f = plot(current, forecast_all{8, o, e}   , '-', 'Color', gY); hold on
en_a = plot(current, analysis_all{7, o, e}   , '-', 'Color', BLUE(2,:)); grid on 

ob_a = plot(current, obs_all{7, o, e}, '*', 'Color', gR, 'MarkerSize', 8); 
ob_r = plot(current, obs_all{8, o, e}, '*', 'Color', rD, 'MarkerSize', 8);

op   = plot(current, openloop_all{1, o}      , '-', 'Color', oR, 'LineWidth', 4); 
mf   = plot(current, forecast_all{6, o, e}   , '-', 'Color', bK, 'LineWidth', 4); 
ma   = plot(current, analysis_all{6, o, e}   , '-', 'Color', bL, 'LineWidth', 4); 

zL = [current(pp+1), current(end-pp)];

set(gca, 'FontSize', 16, 'XLim', zL, ...
         'XTick', current(Z), 'XTickLabel', gt(Z,:), 'Ylim', [0 1800], ...
         'YTickLabelRotation', 90)

L = legend([ob_a, ob_r, op, en_f(1), mf, en_a(1), ma], 'Used Obs (cms)'          , ...
                sprintf('Rejected Obs: %.0f%%'       , 100-obs_all{4, o, e}/obs_all{3, o, e}*100), ...
                sprintf('OL RMSE: %.2f'              , nanmean(openloop_all{2, o})), ...
                'Prior Ensemble', ...
                sprintf('Prior RMSE: %.2f'           , nanmean(forecast_all{2, o, e})), ...
                'Post Ensemble', ...
                sprintf('Post RMSE: %.2f'            , nanmean(analysis_all{2, o, e})), ...
                'Location', 'NorthEast');
        
set(L, 'Interpreter', 'none', 'FontSize', 14) 

ylabel('20-mem RD-EnKF', 'FontSize', 20, 'FontWeight', 'bold')


%%%%%% 5
nexttile; o = OI(2); pp1 = 200; pp2 = 100; dd = 10; Z = ceil(linspace(1, Nt, dd));

en_f = plot(current, forecast_all{8, o, e}   , '-', 'Color', gY); hold on
en_a = plot(current, analysis_all{7, o, e}   , '-', 'Color', BLUE(2,:)); grid on 

ob_a = plot(current, obs_all{7, o, e}, '*', 'Color', gR, 'MarkerSize', 8); 
ob_r = plot(current, obs_all{8, o, e}, '*', 'Color', rD, 'MarkerSize', 8);

op   = plot(current, openloop_all{1, o}      , '-', 'Color', oR, 'LineWidth', 4); 
mf   = plot(current, forecast_all{6, o, e}   , '-', 'Color', bK, 'LineWidth', 4); 
ma   = plot(current, analysis_all{6, o, e}   , '-', 'Color', bL, 'LineWidth', 4); 

zL = [current(pp1+1), current(end-pp2)];

set(gca, 'FontSize', 16, 'XLim', zL, ...
         'XTick', current(Z), 'XTickLabel', gt(Z,:), 'Ylim', [0 50], 'YTick', 5:10:45, ...
         'YTickLabelRotation', 90)

L = legend([ob_a, ob_r, op, en_f(1), mf, en_a(1), ma], 'Used Obs (cms)'          , ...
                sprintf('Rejected Obs: %.0f%%'       , 100-obs_all{4, o, e}/obs_all{3, o, e}*100), ...
                sprintf('OL RMSE: %.2f'              , nanmean(openloop_all{2, o})), ...
                'Prior Ensemble', ...
                sprintf('Prior RMSE: %.2f'           , nanmean(forecast_all{2, o, e})), ...
                'Post Ensemble', ...
                sprintf('Post RMSE: %.2f'            , nanmean(analysis_all{2, o, e})), ...
                'Location', 'NorthEast');
        
set(L, 'Interpreter', 'none', 'FontSize', 14) 


%%%%%% 6
nexttile; o = OI(3); pp = 252; dd = 16; Z = ceil(linspace(1, Nt, dd));

en_f = plot(current, forecast_all{8, o, e}   , '-', 'Color', gY); hold on
en_a = plot(current, analysis_all{7, o, e}   , '-', 'Color', BLUE(2,:)); grid on 

ob_a = plot(current, obs_all{7, o, e}, '*', 'Color', gR, 'MarkerSize', 8); 
ob_r = plot(current, obs_all{8, o, e}, '*', 'Color', rD, 'MarkerSize', 8);

op   = plot(current, openloop_all{1, o}      , '-', 'Color', oR, 'LineWidth', 4); 
mf   = plot(current, forecast_all{6, o, e}   , '-', 'Color', bK, 'LineWidth', 4); 
ma   = plot(current, analysis_all{6, o, e}   , '-', 'Color', bL, 'LineWidth', 4); 

zL = [current(pp+1), current(end-pp)];

set(gca, 'FontSize', 16, 'XLim', zL, ...
         'XTick', current(Z), 'XTickLabel', gt(Z,:), 'Ylim', [0 200], 'ytick', 25:50:175, ...
         'YTickLabelRotation', 90)

L = legend([ob_a, ob_r, op, en_f(1), mf, en_a(1), ma], 'Used Obs (cms)'          , ...
                sprintf('Rejected Obs: %.0f%%'       , 100-obs_all{4, o, e}/obs_all{3, o, e}*100), ...
                sprintf('OL RMSE: %.2f'              , nanmean(openloop_all{2, o})), ...
                'Prior Ensemble', ...
                sprintf('Prior RMSE: %.2f'           , nanmean(forecast_all{2, o, e})), ...
                'Post Ensemble', ...
                sprintf('Post RMSE: %.2f'            , nanmean(analysis_all{2, o, e})), ...
                'Location', 'NorthEast');
        
set(L, 'Interpreter', 'none', 'FontSize', 14)
